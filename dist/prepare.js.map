{"version":3,"sources":["../src/prepare.js"],"names":["context","type","props","p","resolve","instance","createCompositeElementInstance","renderCompositeElementInstance","prepareCompositeElement","updater","enqueueSetState","publicInstance","partialState","callback","newState","state","CompositeComponent","refs","componentWillMount","childContext","getChildContext","render","prepareElement","element","children","prepare","then","all","React","Children","toArray","map","child"],"mappings":"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","file":"prepare.js","sourcesContent":["import React from 'react';\n\nimport isReactCompositeComponent from './utils/isReactCompositeComponent';\nimport isThenable from './utils/isThenable';\nimport { isPrepared, getPrepare } from './prepared';\n\nconst updater = {\n  enqueueSetState(publicInstance, partialState, callback) {\n    const newState = typeof partialState === 'function'\n      ? partialState(publicInstance.state, publicInstance.props)\n      : partialState;\n\n    publicInstance.state = Object.assign({}, publicInstance.state, newState);\n    if (typeof callback === 'function') {\n      callback();\n      return;\n    }\n  },\n};\n\nfunction createCompositeElementInstance(\n  { type: CompositeComponent, props },\n  context,\n) {\n  const instance = new CompositeComponent(props, context);\n  const state = instance.state || null;\n\n  instance.props = props;\n  instance.state = state;\n  instance.context = context;\n  instance.updater = updater;\n  instance.refs = {};\n\n  if (instance.componentWillMount) {\n    instance.componentWillMount();\n  }\n  return instance;\n}\n\nfunction renderCompositeElementInstance(instance, context = {}) {\n  const childContext = Object.assign(\n    {},\n    context,\n    instance.getChildContext ? instance.getChildContext() : {},\n  );\n  return [instance.render(), childContext];\n}\n\nasync function prepareCompositeElement({ type, props }, context) {\n  if (isPrepared(type)) {\n    const p = getPrepare(type)(props, context);\n    if (isThenable(p)) {\n      await p;\n    } else {\n      await Promise.resolve();\n    }\n  } else {\n    await Promise.resolve();\n  }\n  const instance = createCompositeElementInstance({ type, props }, context);\n  return renderCompositeElementInstance(instance, context);\n}\n\nfunction prepareElement(element, context) {\n  if (element === null || typeof element !== 'object') {\n    return Promise.resolve([null, context]);\n  }\n  const { type, props } = element;\n  if (typeof type === 'string') {\n    return Promise.resolve([props.children, context]);\n  }\n  if (!isReactCompositeComponent(type)) {\n    return Promise.resolve([type(props), context]);\n  }\n  return prepareCompositeElement(element, context);\n}\n\nfunction prepare(element, context = {}) {\n  return prepareElement(element, context).then(([children, childContext]) =>\n    Promise.all(\n      React.Children\n        .toArray(children)\n        .map(child => prepare(child, childContext)),\n    ),\n  );\n}\n\nexport default prepare;\n"]}